<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gartic Scanner Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: #0f0f1a;
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(45deg, #2b2b4a, #1f1f3a);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .controls {
            display: flex;
            gap: 15px;
        }

        select, button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            outline: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select {
            background: #2d2d4d;
            color: #fff;
        }

        button {
            background: #4CAF50;
            color: white;
            font-weight: 500;
        }

        button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #2b2b4a;
            padding: 15px 25px;
            border-radius: 12px;
            flex: 1;
            text-align: center;
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .user-card {
            background: linear-gradient(145deg, #2b2b4a, #1f1f3a);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .user-card:hover {
            transform: translateY(-5px);
        }

        .user-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #4CAF50, #45a049);
        }

        .user-card img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 10px auto;
            border: 3px solid #4CAF50;
        }

        .user-info {
            margin-top: 15px;
        }

        .user-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-stats {
            font-size: 14px;
            color: #a0a0a0;
            margin-bottom: 15px;
        }

        .room-link {
            display: inline-block;
            padding: 8px 20px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .room-link:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .loader {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loader div {
            width: 20px;
            height: 20px;
            background: #4CAF50;
            border-radius: 50%;
            display: inline-block;
            margin: 0 5px;
            animation: bounce 0.5s ease infinite alternate;
        }

        .loader div:nth-child(2) {
            animation-delay: 0.15s;
        }

        .loader div:nth-child(3) {
            animation-delay: 0.3s;
        }

        @keyframes bounce {
            to {
                transform: translateY(-15px);
            }
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #4CAF50;
            color: white;
            border-radius: 8px;
            transform: translateX(200%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Gartic Scanner Pro</h1>
            <div class="controls">
                <select id="languageSelect">
                    <option value="8">Türkçe</option>
                    <option value="1">English</option>
                    <option value="3">Português</option>
                    <option value="4">Español</option>
                </select>
                <button onclick="startScanning()">Scan Rooms</button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>Total Players</h3>
                <p id="playerCount">0</p>
            </div>
            <div class="stat-card">
                <h3>Active Rooms</h3>
                <p id="roomCount">0</p>
            </div>
            <div class="stat-card">
                <h3>Scan Speed</h3>
                <p id="scanSpeed">0 ms</p>
            </div>
        </div>

        <div class="loader">
            <div></div>
            <div></div>
            <div></div>
        </div>

        <div id="usersContainer" class="users-grid"></div>
    </div>

    <div class="notification" id="notification"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        class GarticScanner {
            constructor() {
                this.players = new Map();
                this.servers = ['server01', 'server02', 'server03', 'server04', 'server05', 'server06'];
                this.scanning = false;
                this.startTime = 0;
                this.proxyUrl = 'https://corsproxy.io/?';
            }

            async init(language) {
                if (this.scanning) return;
                this.scanning = true;
                this.startTime = performance.now();
                this.showLoader(true);
                this.players.clear();
                
                try {
                    const rooms = await this.getRooms(language);
                    document.getElementById('roomCount').textContent = rooms.length;
                    await this.scanRooms(rooms);
                    this.showNotification(`Scan completed in ${Math.round(performance.now() - this.startTime)}ms`);
                } catch (error) {
                    this.showNotification('Error during scan', true);
                } finally {
                    this.scanning = false;
                    this.showLoader(false);
                }
            }

            async getRooms(language) {
                const response = await fetch(`${this.proxyUrl}${encodeURIComponent(`https://gartic.io/req/list?search=&language[]=${language}`)}`);
                const rooms = await response.json();
                return rooms.filter(room => room.quant > 0);
            }

            async connectToRoom(server, roomCode) {
                return new Promise((resolve, reject) => {
                    const ws = new WebSocket(`wss://${server}.gartic.io/socket.io/?EIO=3&transport=websocket`);
                    
                    const timeout = setTimeout(() => {
                        ws.close();
                        resolve([]);
                    }, 3000);

                    ws.onopen = () => {
                        ws.send(`42[12,{"v":20000,"platform":0,"sala":"${roomCode.slice(-4)}"}]`);
                    };

                    ws.onmessage = (msg) => {
                        if (msg.data[4] === "5") {
                            try {
                                const data = JSON.parse(msg.data.slice(2));
                                if (data[0] === 5) {
                                    clearTimeout(timeout);
                                    ws.close();
                                    resolve(data[5]);
                                }
                            } catch (e) {
                                console.error('Parse error:', e);
                            }
                        }
                    };

                    ws.onerror = () => {
                        clearTimeout(timeout);
                        resolve([]);
                    };
                });
            }

            async scanRooms(rooms) {
                const batchSize = 10;
                for (let i = 0; i < rooms.length; i += batchSize) {
                    const batch = rooms.slice(i, i + batchSize);
                    const promises = batch.flatMap(room => 
                        this.servers.map(server => this.connectToRoom(server, room.code))
                    );
                    
                    const results = await Promise.all(promises);
                    results.flat().forEach(user => {
                        if (user && !this.players.has(user.id)) {
                            this.players.set(user.id, {
                                ...user,
                                room: `https://gartic.io/${rooms[Math.floor(i/batchSize)].code}`
                            });
                        }
                    });
                    
                    this.updateUI();
                    document.getElementById('playerCount').textContent = this.players.size;
                    document.getElementById('scanSpeed').textContent = 
                        `${Math.round(performance.now() - this.startTime)}ms`;
                }
            }

            updateUI() {
                const container = document.getElementById('usersContainer');
                container.innerHTML = '';

                [...this.players.values()].forEach(player => {
                    const card = document.createElement('div');
                    card.className = 'user-card';
                    card.innerHTML = `
                        <img src="${player.foto || `https://gartic.io/static/images/avatar/svg/${player.avatar}.svg`}" 
                             alt="${player.nick}" onerror="this.src='https://gartic.io/static/images/avatar/svg/0.svg'">
                        <div class="user-info">
                            <div class="user-name">${player.nick}</div>
                            <div class="user-stats">
                                ${player.pontos || 0} points • ${player.vitorias || 0} wins
                            </div>
                            <a href="${player.room}" target="_blank" class="room-link">Join Room</a>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }

            showLoader(show) {
                document.querySelector('.loader').style.display = show ? 'block' : 'none';
            }

            showNotification(message, isError = false) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.style.background = isError ? '#ff4444' : '#4CAF50';
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 3000);
            }
        }

        async function startScanning() {
            const scanner = new GarticScanner();
            const language = document.getElementById('languageSelect').value;
            await scanner.init(language);
        }
    </script>
</body>
</html>
